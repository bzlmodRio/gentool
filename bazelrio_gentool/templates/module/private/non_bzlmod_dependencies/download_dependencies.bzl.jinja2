load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

def download_dependencies():
    # JVM External
    RULES_JVM_EXTERNAL_TAG = "4.2"
    RULES_JVM_EXTERNAL_SHA = "cd1a77b7b02e8e008439ca76fd34f5b07aecb8c752961f9640dea15e9e5ba1ca"
    http_archive(
        name = "rules_jvm_external",
        sha256 = RULES_JVM_EXTERNAL_SHA,
        strip_prefix = "rules_jvm_external-%s" % RULES_JVM_EXTERNAL_TAG,
        url = "https://github.com/bazelbuild/rules_jvm_external/archive/%s.zip" % RULES_JVM_EXTERNAL_TAG,
    )

    # Bazelrio Rules
    {%- if mandetory_dependencies.rules_bazelrio.use_local_version %}
    native.local_repository(
        name = "rules_bazelrio",
        path = "../../bzlmodRio-rules_bazelrio",
    )
    {%- else %}
    http_archive(
        name = "rules_bazelrio",
        sha256 = "{{ mandetory_dependencies.rules_bazelrio.sha }}",
        strip_prefix = "rules_bazelrio-{{ mandetory_dependencies.rules_bazelrio.version }}",
        url = "https://github.com/bzlmodRio/rules_bazelrio/archive/refs/tags/{{ mandetory_dependencies.rules_bazelrio.version }}.tar.gz",
    )
    {%- endif %}

    # Roborio Toolchain
    {%- if mandetory_dependencies.rules_roborio_toolchain.use_local_version %}
    native.local_repository(
        name = "rules_roborio_toolchain",
        path = "../../rules_roborio_toolchain",
    )
    {%- else %}
    http_archive(
        name = "rules_roborio_toolchain",
        sha256 = "{{ mandetory_dependencies.rules_roborio_toolchain.sha }}",
        strip_prefix = "rules_roborio_toolchain-{{ mandetory_dependencies.rules_roborio_toolchain.version }}",
        url = "https://github.com/bzlmodRio/rules_roborio_toolchain/archive/refs/tags/{{ mandetory_dependencies.rules_roborio_toolchain.version }}.tar.gz",
    )
    {%- endif %}

    ########################
    # bzlmodRio dependencies
{% for name, module_dep in group.module_dependencies.items() %}
    # {{name}}
{%- if module_dep.use_local_version %}
    native.local_repository(
        name = "{{name}}",
        path = "{{module_dep.local_rel_folder}}",
    )
{%- else %}
    http_archive(
        name = "{{name}}",
        sha256 = "{{module_dep.remote_sha}}",
        strip_prefix = "{{module_dep.remote_repo}}-{{module_dep.container.version}}",
        url = "https://github.com/bzlmodRio/{{module_dep.remote_repo}}/archive/refs/tags/{{module_dep.container.version}}.tar.gz",
    )
{%- endif %}
{% endfor %}
    ########################

