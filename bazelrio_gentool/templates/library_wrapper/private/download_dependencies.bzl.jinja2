load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

def download_dependencies():
    # JVM External
    RULES_JVM_EXTERNAL_TAG = "{{bazel_dependencies.rules_jvm_external.version}}"
    RULES_JVM_EXTERNAL_SHA = "{{bazel_dependencies.rules_jvm_external.sha}}"
    http_archive(
        name = "rules_jvm_external",
        sha256 = RULES_JVM_EXTERNAL_SHA,
        strip_prefix = "rules_jvm_external-%s" % RULES_JVM_EXTERNAL_TAG,
        url = "https://github.com/bazelbuild/rules_jvm_external/archive/%s.zip" % RULES_JVM_EXTERNAL_TAG,
    )

    # Bazelrio Rules
    {%- if mandetory_dependencies.rules_bazelrio.use_local_version %}
    native.local_repository(
        name = "rules_bazelrio",
        path = "../../rules_bazelrio",
    )
    {%- else %}
    http_archive(
        name = "rules_bazelrio",
        sha256 = "{{ mandetory_dependencies.rules_bazelrio.sha }}",
        strip_prefix = "rules_bazelrio-{{ mandetory_dependencies.rules_bazelrio.version }}",
        url = "https://github.com/bzlmodRio/rules_bazelrio/archive/refs/tags/{{ mandetory_dependencies.rules_bazelrio.version }}.tar.gz",
    )
    {%- endif %}
{%- if not no_roborio %}

    # Roborio Toolchain
    {%- if mandetory_dependencies.rules_roborio_toolchain.use_local_version %}
    native.local_repository(
        name = "rules_bzlmodrio_toolchains",
        path = "../../rules_bzlmodrio_toolchains",
    )
    {%- else %}
    http_archive(
        name = "rules_bzlmodrio_toolchains",
        sha256 = "{{ mandetory_dependencies.rules_roborio_toolchain.sha }}",
        strip_prefix = "rules_bzlmodrio_toolchains-{{ mandetory_dependencies.rules_roborio_toolchain.version }}",
        url = "https://github.com/bzlmodRio/rules_bzlmodrio_toolchains/archive/refs/tags/{{ mandetory_dependencies.rules_roborio_toolchain.version }}.tar.gz",
    )
    {%- endif %}
{%- endif %}

    ########################
    # bzlmodRio dependencies
{% for name, module_dep in group.module_dependencies.items() %}
    # {{name}}
{%- if module_dep.use_local_version %}
    native.local_repository(
        name = "{{name}}",
        path = "{{module_dep.local_rel_folder}}",
    )
{%- else %}
    http_archive(
        name = "{{name}}",
        sha256 = "{{module_dep.remote_sha}}",
        strip_prefix = "{{module_dep.remote_repo}}-{{module_dep.container.version}}{{module_dep.container.patch}}",
        url = "https://github.com/bzlmodRio/{{module_dep.remote_repo}}/archive/refs/tags/{{module_dep.container.version}}{{module_dep.container.patch}}.tar.gz",
    )
{%- endif %}
{% endfor %}
    ########################

